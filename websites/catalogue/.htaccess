RewriteEngine on
ErrorDocument 404 /error.php?code=404
ErrorDocument 403 /error.php?code=403

#Favicon depending on host
RewriteCond %{HTTP_HOST} ^anime.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^animev2.fansubs.cat$
RewriteRule ^favicon\.ico$ images/favicon_anime.ico [L]
RewriteCond %{HTTP_HOST} ^anime.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^animev2.fansubs.cat$
RewriteRule ^favicon\.png$ images/favicon_anime.png [L]
RewriteCond %{HTTP_HOST} ^manga.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^mangav2.fansubs.cat$
RewriteRule ^favicon\.ico$ images/favicon_manga.ico [L]
RewriteCond %{HTTP_HOST} ^manga.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^mangav2.fansubs.cat$
RewriteRule ^favicon\.png$ images/favicon_manga.png [L]
RewriteCond %{HTTP_HOST} ^accioreal.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^acciorealv2.fansubs.cat$
RewriteRule ^favicon\.ico$ images/favicon_liveaction.ico [L]
RewriteCond %{HTTP_HOST} ^accioreal.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^acciorealv2.fansubs.cat$
RewriteRule ^favicon\.png$ images/favicon_liveaction.png [L]

#Hide internal files
RewriteCond %{THE_REQUEST} ^.+?\ [^?]+\.php[?\ ]
RewriteCond %{REQUEST_URI} !error\.php
RewriteCond %{REQUEST_URI} !counter\.php
RewriteCond %{REQUEST_URI} !reader\.php
RewriteCond %{REQUEST_URI} !strip_reader\.php
RewriteRule \.php$ - [F]

#Preview image
RewriteRule ^preview/([^/]*)\.jpg$ preview_image.php?slug=$1 [L]

#Normal pages - depending on host
#Anime / Live action
RewriteCond %{HTTP_HOST} ^anime.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^animev2.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^accioreal.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^acciorealv2.fansubs.cat$
RewriteRule ^films/?$ index.php?page=movies [L]
RewriteCond %{HTTP_HOST} ^anime.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^animev2.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^accioreal.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^acciorealv2.fansubs.cat$
RewriteRule ^series/?$ index.php?page=series [L]
RewriteCond %{HTTP_HOST} ^anime.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^animev2.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^accioreal.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^acciorealv2.fansubs.cat$
RewriteRule ^films/([^/]*)/?$ series.php?page=movies&slug=$1 [QSA,L]
RewriteCond %{HTTP_HOST} ^anime.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^animev2.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^accioreal.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^acciorealv2.fansubs.cat$
RewriteRule ^series/([^/]*)/?$ series.php?page=series&slug=$1 [QSA,L]

#Manga
RewriteCond %{HTTP_HOST} ^manga.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^mangav2.fansubs.cat$
RewriteRule ^one-shots/?$ index.php?page=oneshots [L]
RewriteCond %{HTTP_HOST} ^manga.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^mangav2.fansubs.cat$
RewriteRule ^serialitzats/?$ index.php?page=serialized [L]
RewriteCond %{HTTP_HOST} ^manga.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^mangav2.fansubs.cat$
RewriteRule ^one-shots/([^/]*)/?$ series.php?page=oneshots&slug=$1 [QSA,L]
RewriteCond %{HTTP_HOST} ^manga.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^mangav2.fansubs.cat$
RewriteRule ^serialitzats/([^/]*)/?$ series.php?page=serialized&slug=$1 [QSA,L]

#Generic pages
RewriteRule ^cerca/(.*)/?$ index.php?page=search&query=$1 [QSA,L]
RewriteRule ^qui-som/?$ about.php [L]
RewriteRule ^embed/([^/]*)/?$ embed.php?file_id=$1 [L]

#Old migration for manga
RewriteCond %{HTTP_HOST} ^manga.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^mangav2.fansubs.cat$
RewriteRule ^index/category/(.*)-(.*)$ migration.php?id=$1
RewriteCond %{HTTP_HOST} ^manga.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^mangav2.fansubs.cat$
RewriteRule ^index/category/(.*)$ migration.php?id=$1
RewriteCond %{HTTP_HOST} ^manga.fansubs.cat$ [OR]
RewriteCond %{HTTP_HOST} ^mangav2.fansubs.cat$
RewriteRule ^picture/(.*)/category/(.*)-(.*)$ migration.php?id=$2
